<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Dashboard â€“ CafÃ©Misu Ã— We Padel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

<style>
    body {
        font-family: 'Playfair Display', serif;
        background: #F7EFEA;
        margin: 0;
        padding: 20px;
        color: #5D3A2C;
    }

    h1 {
        text-align: center;
        font-size: 2.2rem;
        margin-bottom: 25px;
    }

    .filter-bar {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: 25px;
    }

    .filter-btn {
        padding: 10px 15px;
        border-radius: 8px;
        border: none;
        background: #D4D4D8;
        color: #333;
        font-weight: 600;
        cursor: pointer;
    }

    .filter-btn.active {
        color: white;
    }

    /* Couleurs filtres */
    .active.new     { background: #DC2626 !important; } /* rouge */
    .active.served  { background: #16A34A !important; } /* vert */
    .active.paid    { background: #16A34A !important; } /* vert */
    .active.done    { background: #7C3AED !important; } /* violet */
    .active.all     { background: #444 !important; }    

    .order-card {
        background: white;
        padding: 20px;
        border-radius: 14px;
        margin-bottom: 18px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 14px;
    }

    .status-row {
        display: flex;
        gap: 8px;
        margin-bottom: 10px;
    }

    .status-btn {
        padding: 8px 14px;
        background: #D4D4D8;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        border: none;
    }

    /* Couleurs statuts quand actifs */
    .status-btn.active-new {
        background: #DC2626;
        color: white;
    }
    .status-btn.active-served,
    .status-btn.active-paid {
        background: #16A34A;
        color: white;
    }
    .status-btn.active-done {
        background: #7C3AED;
        color: white;
    }

    .order-footer {
        display: flex;
        justify-content: flex-end;
        margin-top: 15px;
    }

    .btn-end {
        background-color: #7C3AED;
        color: white;
        padding: 10px 18px;
        border-radius: 8px;
        font-size: 0.9rem;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: 0.2s;
    }

    .btn-end:hover {
        background-color: #6D28D9;
    }
</style>
</head>

<body>

<h1>ðŸ“‹ Commandes â€“ CafÃ©Misu Ã— We Padel</h1>

<!-- BARRE DE FILTRES -->
<div class="filter-bar">
    <button class="filter-btn active all" onclick="setFilter('all')">Toutes</button>
    <button class="filter-btn new" onclick="setFilter('new')">Nouvelle commande</button>
    <button class="filter-btn served" onclick="setFilter('served')">Servies</button>
    <button class="filter-btn paid" onclick="setFilter('paid')">PayÃ©es</button>
    <button class="filter-btn done" onclick="setFilter('done')">TerminÃ©es</button>
</div>

<div id="orders"></div>

<!-- FIREBASE + LOGIQUE -->
<script>
/* ---------------------- CONFIG FIREBASE ---------------------- */
const firebaseConfig = {
    apiKey: "AIzaSyDb7QDl0VF5vhQahUaua5z2EzYQovdt9Y",
    authDomain: "cafemisu-wepadel.firebaseapp.com",
    projectId: "cafemisu-wepadel",
    storageBucket: "cafemisu-wepadel.firebasestorage.app",
    messagingSenderId: "158465399626",
    appId: "1:158465399626:web:382a8671ca9b32b3aba4273"
};

const app = firebase.initializeApp(firebaseConfig);
const db  = firebase.firestore();

/* ---------------------- AFFICHAGE ---------------------- */
let currentFilter = "all";

function setFilter(f) {
    currentFilter = f;

    document.querySelectorAll(".filter-btn").forEach(btn => btn.classList.remove("active"));
    document.querySelector(`.filter-btn.${f}`)?.classList.add("active");

    loadOrders();
}

function loadOrders() {
    db.collection("orders")
      .orderBy("timestamp", "asc")
      .onSnapshot(snapshot => {

        let html = "";
        snapshot.forEach(doc => {
            const d = doc.data();
            d.id = doc.id;

            if (currentFilter !== "all" && d.status !== currentFilter)
                return;

            html += generateOrderCard(d);
        });

        document.getElementById("orders").innerHTML = html;
      });
}

function generateOrderCard(d) {
    return `
    <div class="order-card">

        <h2>Table ${d.table}</h2>

        <!-- STATUTS -->
        <div class="status-row">
            <button class="status-btn ${d.status==='new'     ? 'active-new'   : ''}"
                onclick="updateStatus('${d.id}','new')">Nouvelle commande</button>

            <button class="status-btn ${d.status==='served'  ? 'active-served': ''}"
                onclick="updateStatus('${d.id}','served')">Servi</button>

            <button class="status-btn ${d.status==='paid'    ? 'active-paid'  : ''}"
                onclick="updateStatus('${d.id}','paid')">PayÃ©</button>

            <button class="status-btn ${d.status==='done'    ? 'active-done'  : ''}"
                onclick="updateStatus('${d.id}','done')">TerminÃ©</button>
        </div>

        <ul>
           ${d.items.map(i => `<li>${i.name} â€” ${i.price.toLocaleString()} FCFA</li>`).join("")}
        </ul>

        <p><i>Client :</i> ${d.customer || "â€”"}</p>
        <p><i>ReÃ§u :</i> ${d.time}</p>

        <div class="order-footer">
            <button class="btn-end" onclick="finishOrder('${d.id}')">Terminer</button>
        </div>

    </div>
    `;
}

/* ---------------------- ACTIONS ---------------------- */
function updateStatus(id, status) {
    db.collection("orders").doc(id).update({ status });
}

function finishOrder(id) {
    db.collection("orders").doc(id).update({ status: "done" });
}

/* ---------------------- INIT ---------------------- */
loadOrders();
</script>

</body>
</html>
