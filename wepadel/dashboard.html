<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Commandes â€“ CafÃ©Misu Ã— We Padel</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">

<style>
    body {
        margin: 0;
        padding: 20px;
        background: #F9F5F1;
        font-family: 'Playfair Display', serif;
        color: #7a5b47;
    }

    h1 {
        text-align: center;
        margin-bottom: 25px;
        font-size: 2.4rem;
        font-weight: 700;
    }

    /* ===== CARD ===== */

    .card {
        background: #fff;
        padding: 20px;
        border-radius: 18px;
        margin: 25px 0;
        box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    }

    /* Ligne supÃ©rieure : Table + boutons */
    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        flex-wrap: wrap;
        gap: 10px;
    }

    .table-number {
        font-size: 1.7rem;
        font-weight: 700;
        color: #A87555;
    }

    /* Conteneur boutons + badge */
    .badges {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    /* Boutons statut â€” tous GRIS */
    .status-btn {
        padding: 8px 16px;
        border-radius: 10px;
        font-size: 1rem;
        cursor: pointer;
        border: none;
        font-weight: 600;
        color: white;
        background: #6B7280; /* gris */
    }

    /* Bouton actif = VERT */
    .active-status {
        background: #7CCC54 !important;
    }

    /* Badge paid */
    .badge {
        padding: 7px 15px;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        color: white;
        background: #444;
    }

    /* Liste des items */
    .order-items {
        margin-top: 10px;
        padding-left: 25px;
    }

    .order-items li {
        margin: 6px 0;
        font-size: 1.15rem;
    }

    /* Infos client */
    .client {
        margin-top: 10px;
        font-style: italic;
        font-size: 1.1rem;
        color: #7a5b47;
    }

    .date {
        font-size: 0.95rem;
        margin-top: 6px;
        opacity: 0.7;
    }
</style>
</head>

<body>

<h1>ðŸ“‹ Commandes â€“ CafÃ©Misu Ã— We Padel</h1>

<div id="orders"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, query, orderBy, onSnapshot, updateDoc, doc }
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDb7QI70lVF5vhQahUau5z2E7QOvdte9Y",
        authDomain: "cafemisu-wepadel.firebaseapp.com",
        projectId: "cafemisu-wepadel",
        storageBucket: "cafemisu-wepadel.appspot.com",
        messagingSenderId: "184586399626",
        appId: "1:184586399626:web:382a3671ca9b32baba4273"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const ordersDiv = document.getElementById("orders");

    // RÃ©cupÃ©ration temps rÃ©el
    const q = query(collection(db, "orders"), orderBy("createdAt", "desc"));

    onSnapshot(q, (snapshot) => {
        ordersDiv.innerHTML = "";

        snapshot.forEach((docSnap) => {
            const data = docSnap.data();

            const card = document.createElement("div");
            card.className = "card";

            const paidBadge = data.status === "paid"
                ? '<span class="badge">payÃ©</span>'
                : '';

            // STRUCTURE DE LA CARTE
            card.innerHTML = `
                <div class="card-header">
                    <div class="table-number">Table ${data.table}</div>

                    <div class="badges">
                        <button class="status-btn" data-id="${docSnap.id}" data-status="preparing">PrÃ©parer</button>
                        <button class="status-btn" data-id="${docSnap.id}" data-status="served">Servi</button>
                        <button class="status-btn" data-id="${docSnap.id}" data-status="paid">PayÃ©</button>

                        ${paidBadge}
                    </div>
                </div>

                <ul class="order-items">
                    ${data.items
                        .map(i => `<li>${i.name} â€” ${i.price.toLocaleString()} FCFA</li>`)
                        .join("")}
                </ul>

                <div class="client">Client : ${data.name || "â€”"}</div>
                <div class="date">ReÃ§u : ${data.createdAt?.toDate().toLocaleString("fr-FR")}</div>
            `;

            ordersDiv.appendChild(card);

            /* ----- Activation visuelle du bouton ----- */
            const buttons = card.querySelectorAll(".status-btn");
            buttons.forEach(btn => {
                if (btn.dataset.status === data.status) {
                    btn.classList.add("active-status");
                }
            });

            /* ----- Gestion clic des statuts ----- */
            buttons.forEach(btn => {
                btn.addEventListener("click", async () => {
                    const id = btn.getAttribute("data-id");
                    const newStatus = btn.getAttribute("data-status");

                    // Mise Ã  jour Firestore
                    await updateDoc(doc(db, "orders", id), { status: newStatus });

                    // Reset des boutons
                    buttons.forEach(b => b.classList.remove("active-status"));

                    // Activation bouton cliquÃ©
                    btn.classList.add("active-status");
                });
            });
        });
    });
</script>

</body>
</html>
