<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CaféMisu × We Padel – Commander</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">

<style>
    body {
        background-color: #F9F5F1;
        font-family: 'Playfair Display', serif;
        color: #A87555;
        margin: 0;
        padding: 0 20px 200px;
        line-height: 1.65;
    }

    /* --------------------------------------
        BOUTON RETOUR À L’ACCUEIL — STYLE CAFÉMISU
    --------------------------------------- */
    .back-btn {
        display: block;
        width: 80%;
        margin: 25px auto 0;
        padding: 12px 20px;
        text-align: center;
        text-decoration: none;
        border: 2px solid #A87555;
        border-radius: 10px;
        color: #A87555;
        font-size: 1.15rem;
        font-weight: 700;
        transition: 0.25s ease;
        background: white;
        box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }

    .back-btn:hover {
        background: rgba(168,117,85,0.08);
        transform: translateY(-3px);
    }

    .back-btn:active {
        transform: scale(0.96);
    }

    h1 {
        text-align: center;
        margin-top: 25px;
        font-size: 2.5rem;
        font-weight: 700;
    }

    h2 {
        font-size: 1.7rem;
        margin-top: 35px;
        margin-bottom: 10px;
        border-bottom: 2px solid #A87555;
        display: inline-block;
        padding-bottom: 5px;
    }

    .item {
        background: white;
        padding: 16px;
        margin: 14px 0;
        border-radius: 12px;
        box-shadow: 0px 4px 10px rgba(0,0,0,0.07);
    }

    .item-title {
        font-size: 1.3rem;
        margin: 0 0 6px;
        font-weight: 600;
    }

    .item-price {
        font-size: 1.2rem;
        margin-bottom: 10px;
    }

    button.add {
        background-color: #A87555;
        color: white;
        border: none;
        padding: 10px 18px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
    }

    /* Cart bottom bar */
    #cart {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: #A87555;
        color: white;
        padding: 18px 22px;
        font-size: 1.2rem;
        font-weight: 600;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 999;
    }

    #cart button {
        background: white;
        color: #A87555;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1rem;
    }

    /* Checkout form */
    #checkout {
        display: none;
        padding: 20px;
        background: white;
        border-radius: 12px;
        margin-top: 30px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    input {
        width: 100%;
        padding: 12px;
        margin: 10px 0 22px;
        border: 1px solid #d7c7bd;
        border-radius: 8px;
        font-size: 1rem;
    }

    #confirm-btn {
        width: 100%;
        background-color: #A87555;
        color: white;
        padding: 14px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1.2rem;
        margin-top: 12px;
    }

    /* Popup variations lait végétal */
    #variant-overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.55);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    #variant-popup {
        background: white;
        padding: 25px;
        width: 85%;
        max-width: 380px;
        border-radius: 16px;
        text-align: center;
        color: #A87555;
        box-shadow: 0 8px 25px rgba(0,0,0,0.22);
    }

    .variant-btn {
        padding: 12px 20px;
        background: #F9F5F1;
        border: 2px solid #A87555;
        border-radius: 8px;
        margin: 10px 0;
        width: 100%;
        font-size: 1.1rem;
        cursor: pointer;
        transition: .2s;
    }

    .variant-btn:hover {
        background: #F3E5DB;
    }

</style>
</head>

<body>

<!-- ------------------ BOUTON RETOUR ------------------ -->
<a href="https://cafemisu.fr" class="back-btn">← Retour à l’accueil</a>

<h1>CaféMisu × We Padel</h1>

<div id="menu"></div>

<div id="cart">
    <span id="cart-count">0 article(s)</span>
    <button onclick="openCheckout()">Valider</button>
</div>

<div id="checkout">
    <h2>Finaliser votre commande</h2>

    <label>Numéro de table *</label>
    <input type="number" id="table-number" placeholder="Ex: 7" required>

    <label>Nom (optionnel)</label>
    <input type="text" id="client-name" placeholder="Votre nom">

    <button id="confirm-btn">Envoyer la commande</button>
</div>

<!-- Popup variations lait végétal -->
<div id="variant-overlay">
    <div id="variant-popup">
        <h2 style="margin-top:0">Choix du lait végétal</h2>

        <button class="variant-btn" onclick="selectVariant('Avoine')">Avoine</button>
        <button class="variant-btn" onclick="selectVariant('Amande')">Amande</button>
        <button class="variant-btn" onclick="selectVariant('Soja')">Soja</button>
        <button class="variant-btn" onclick="selectVariant('Coco')">Coco</button>

        <button class="variant-btn" style="margin-top:16px;background:white"
            onclick="closeVariant()">Annuler</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDb7QDl0VF5vhQahUaua5z2EzYQovdt9Y",
        authDomain: "cafemisu-wepadel.firebaseapp.com",
        projectId: "cafemisu-wepadel",
        storageBucket: "cafemisu-wepadel.appspot.com",
        messagingSenderId: "158465399626",
        appId: "1:158465399626:web:382a8671ca9b32b3aba4273"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const LAIT_NAMES = [
        "Lait végétal",
    ];

    const menuItems = [
        { category: "Les frappés", name: "Latté Frappé", price: 4500 },
        { category: "Les frappés", name: "Matcha Frappé", price: 5500 },
        { category: "Les frappés", name: "Caramel Frappé", price: 5500 },
        { category: "Les frappés", name: "Lait végétal", price: 1000 },

        { category: "Les matchas", name: "Iced Matcha Latte", price: 5500 },
        { category: "Les matchas", name: "Coconut Matcha Cloud", price: 5500 },
        { category: "Les matchas", name: "Strawberry Matcha", price: 6500 },
        { category: "Les matchas", name: "Mango Matcha", price: 6500 },
        { category: "Les matchas", name: "Lait végétal", price: 1000 },

        { category: "Les lattés", name: "Iced Americano", price: 4000 },
        { category: "Les lattés", name: "Spanish Iced Latte", price: 5500 },
        { category: "Les lattés", name: "Iced Coffee Latte", price: 4500 },
        { category: "Les lattés", name: "Lait végétal", price: 1000 },

        { category: "Boissons chaudes", name: "Café au lait", price: 3500 },
        { category: "Boissons chaudes", name: "Thé", price: 1500 },
        { category: "Boissons chaudes", name: "Chocolat chaud", price: 3500 },
        { category: "Boissons chaudes", name: "Espresso", price: 1000 },
        { category: "Boissons chaudes", name: "Americano", price: 2000 },
        { category: "Boissons chaudes", name: "Cappuccino", price: 3500 },
        { category: "Boissons chaudes", name: "Lait végétal", price: 1000 },

        { category: "Les spéciaux", name: "Caramel Machiatto", price: 6500 }, 
        { category: "Les spéciaux", name: "Iced Chocolate", price: 5000 },
        { category: "Les spéciaux", name: "UBE Latte", price: 7000 },
        { category: "Les spéciaux", name: "Lait végétal", price: 1000 },

        { category: "Boissons gazeuses", name: "Coca", price: 1000 },
        { category: "Boissons gazeuses", name: "Sprite", price: 1000 },
        { category: "Boissons gazeuses", name: "Fanta", price: 1000 },
        { category: "Boissons gazeuses", name: "Ice Tea", price: 1000 },
        { category: "Boissons gazeuses", name: "Cody’s", price: 1000 },
        { category: "Boissons gazeuses", name: "Redbull", price: 2000 },
        { category: "Boissons gazeuses", name: "Perrier", price: 2000 },
        { category: "Boissons gazeuses", name: "Eau", price: 1000 },

        { category: "Spéciaux du weekend", name: "Tiramisu Cake Latte", price: 7000 },
        { category: "Spéciaux du weekend", name: "Tiramisu Cake Matcha Latte", price: 7500 },
        { category: "Spéciaux du weekend", name: "Matcha Banana Pudding", price: 7500 },
        { category: "Spéciaux du weekend", name: "LE LATTE XXXL", price: 25000 },
        { category: "Spéciaux du weekend", name: "LE MATCHA XXXL", price: 30000 },
        { category: "Spéciaux du weekend", name: "Lait végétal", price: 1000 },

        { category: "Tiramisu", name: "Tiramisu Café", price: 4000 },
        { category: "Tiramisu", name: "Tiramisu Matcha", price: 5000 },
        { category: "Tiramisu", name: "Tiramisu Nutella", price: 5000 },
        { category: "Tiramisu", name: "Tiramisu Fraise", price: 5500 },
        { category: "Tiramisu", name: "Tiramisu Spéculos", price: 5000 }, 
        { category: "Tiramisu", name: "Tiramisu Ferrero", price: 5500 },
        { category: "Tiramisu", name: "Tiramisu Bueno", price: 5500 },
        { category: "Tiramisu", name: "Tiramisu Pistache", price: 5500 },
        { category: "Tiramisu", name: "Tiramisu Oreo", price: 5000 }
    ];

    const menuDiv = document.getElementById("menu");
    let cart = [];
    let pendingIndex = null;

    function renderMenu() {
        let currentCategory = "";
        menuItems.forEach((item, index) => {
            if (item.category !== currentCategory) {
                currentCategory = item.category;
                menuDiv.innerHTML += `<h2>${currentCategory}</h2>`;
            }

            menuDiv.innerHTML += `
                <div class="item">
                    <div class="item-title">${item.name}</div>
                    <div class="item-price">${item.price.toLocaleString()} FCFA</div>
                    <button class="add" onclick="handleAdd(${index})">Ajouter</button>
                </div>
            `;
        });
    }
    renderMenu();

    window.handleAdd = function(index) {
        const item = menuItems[index];

        if (LAIT_NAMES.includes(item.name)) {
            pendingIndex = index;
            document.getElementById("variant-overlay").style.display = "flex";
        } else {
            addToCart(index);
        }
    };

    window.selectVariant = function(variant) {
        const base = menuItems[pendingIndex];
        cart.push({ name: base.name + " – " + variant, price: base.price });

        updateCartDisplay();
        closeVariant();
    };

    window.closeVariant = function() {
        document.getElementById("variant-overlay").style.display = "none";
        pendingIndex = null;
    };

    window.addToCart = function(index) {
        cart.push(menuItems[index]);
        updateCartDisplay();
    };

    function updateCartDisplay() {
        document.getElementById("cart-count").textContent =
            cart.length + " article(s)";
    }

    window.openCheckout = function() {
        document.getElementById("checkout").style.display = "block";
        window.scrollTo(0, document.body.scrollHeight);
    };

    function sendOrderHandler() {
        const table = document.getElementById("table-number").value;
        const customer = document.getElementById("client-name").value || "—";

        if (!table) {
            alert("Veuillez entrer votre numéro de table.");
            return;
        }

        const now = new Date();
        const timeString =
            now.getDate().toString().padStart(2, "0") + "/" +
            (now.getMonth() + 1).toString().padStart(2, "0") + "/" +
            now.getFullYear() + " " +
            now.getHours().toString().padStart(2, "0") + ":" +
            now.getMinutes().toString().padStart(2, "0");

        addDoc(collection(db, "orders"), {
            items: cart,
            table: table,
            customer: customer,
            status: "new",
            timestamp: serverTimestamp(),
            time: timeString
        })
            .then(() => {
                alert("Votre commande a été envoyée !");
                window.location.href = "order.html";
            })
            .catch((error) => {
                console.error("Erreur Firestore :", error);
                alert("Une erreur est survenue. Réessayez.");
            });
    }

    document.getElementById("confirm-btn")
        .addEventListener("click", sendOrderHandler);

</script>

</body>
</html>
